var BLASS=BLASS||{};
BLASS.EmailAddressInput={_inputTable:null,_tableObj:null,_inputDiv:null,_virtualAddressInput:null,_inputStyle:null,_inputRuler:null,_addressBoxUl:null,_addressBoxList:null,_addressBoxId:0,_addressBoxIdPrefix:"__BLASS_EMAILINPUT_",_autoCompleteHandler:null,_autoCompleteCallback:null,_autoCompleteDiv:null,_autoCompleteData:null,_autoCompleteResult:null,_autoCompleteLast:null,_selectedAutoCompleteIndex:-1,_selectedAutoCompleteProcess:!0,_growSize:0,_checkInputInterval:250,_checkInput:!1,_checkInputCounter:3,
_checkInputBuffer:null,_existCSS:!1,init:function(a,b,c){a&&(this._inputTable=a);this._inputTable&&(this._tableObj=document.getElementById(this._inputTable));c&&(c.handler&&(this._autoCompleteHandler=c.handler),c.callback&&(this._autoCompleteCallback=c.callback));this._inputStyle={border:b&&b.border?b.border:"solid 1px #b5b5b5",backgroundColor:b&&b.backgroundColor?b.backgroundColor:"#ffffff",width:b&&b.width?b.width:"100%",fontSize:b&&b.fontSize?b.fontSize:"12px",id:b&&b.id?b.id:""};this._addressBoxList=
[];this._createCSS();this._createInput()},clone:function(a,b){b||a||(a=this);if(null===a||"object"!==typeof a)return a;var c=new a.constructor,d;for(d in a)a.hasOwnProperty(d)&&(c[d]=a.clone(a[d],!0));c._existCSS=!0;return c},_createInput:function(){if(this._tableObj){this._inputDiv=this._getInput();this._inputRuler=this._getRuler();this._addressBoxUl=this._getAddressBoxUl();var a=this._getAddressBoxLi();this._addressBoxList.push(a);this._virtualAddressInput=this._getVirtualAddressInput();this._autoCompleteDiv=
this._getAutoComplete();a.appendChild(this._virtualAddressInput);this._addressBoxUl.appendChild(a);this._inputDiv.appendChild(this._inputRuler);this._inputDiv.appendChild(this._addressBoxUl);this._tableObj.appendChild(this._inputDiv);this._tableObj.appendChild(this._autoCompleteDiv);this._inputDiv.blass=this;this._virtualAddressInput.blass=this;this._inputDiv.onclick=function(a){this.blass._focusVirtualAddressInput(a)};this._virtualAddressInput.onkeyup=function(a){return this.blass._createAddressInput(a,
this)};this._virtualAddressInput.onkeydown=function(a){return this.blass._createAddressSpecialInput(a,this)};this._virtualAddressInput.onkeypress=function(a){this.blass._checkInput=!0;this.blass._checkInputData()};this._virtualAddressInput.onblur=function(a){this.blass._createAddressInput({keyCode:13},this);this.blass._checkInput=!1}}},_getAutoComplete:function(){var a=document.createElement("div");a.className="blass_eai_ac";return a},_setAutoCompleteData:function(a){this._autoCompleteHandler&&this._selectedAutoCompleteProcess&&
a&&(this._selectedAutoCompleteProcess=!1,this._resetAutoCompleteData(),this._autoCompleteLast=a,this._autoCompleteCallback?(this._autoCompleteCallback.blass=this,this._autoCompleteHandler(a,this._autoCompleteCallback)):(this._autoCompleteData=this._autoCompleteHandler(a),this._showAutoCompleteLayer()))},setAutoCompleteCallBack:function(a){this._autoCompleteData=a;this._showAutoCompleteLayer()},_showAutoCompleteLayer:function(){this._selectedAutoCompleteProcess=!0;if(this._autoCompleteData&&0!==this._autoCompleteData.length){var a;
for(a=0;a<this._autoCompleteData.length;++a){var b=document.createElement("div");b.innerHTML=this._autoCompleteData[a].text;b.className="blass_eai_aclayer";b.blass=this;b.index=a;b.onclick=function(a){a={keyCode:13};this.blass._selectedAutoCompleteIndex=this.index;this.blass._createAddressInput(a,this.blass._virtualAddressInput);this.blass._focusVirtualAddressInput()};this._autoCompleteDiv.appendChild(b);this._autoCompleteResult.push(b)}this._autoCompleteDiv.style.visibility="visible";this._selectAutoCompleteData(1)}},
_selectAutoCompleteData:function(a){this._autoCompleteData&&0!==this._autoCompleteData.length&&(0<=this._selectedAutoCompleteIndex&&(this._autoCompleteResult[this._selectedAutoCompleteIndex].className="blass_eai_aclayer blass_eai_normal"),this._selectedAutoCompleteIndex+=a,0>this._selectedAutoCompleteIndex?this._selectedAutoCompleteIndex=-1:(0>this._selectedAutoCompleteIndex&&(this._selectedAutoCompleteIndex=0),this._selectedAutoCompleteIndex>=this._autoCompleteResult.length&&(this._selectedAutoCompleteIndex=
this._autoCompleteResult.length-1),this._autoCompleteResult[this._selectedAutoCompleteIndex].className="blass_eai_aclayer blass_eai_select"))},_resetAutoCompleteData:function(){this._autoCompleteDiv.style.visibility="hidden";var a;for(a=this._autoCompleteDiv.childNodes.length-1;0<=a;a--)this._autoCompleteDiv.removeChild(this._autoCompleteDiv.childNodes[a]);this._selectedAutoCompleteIndex=-1;this._autoCompleteData=null;this._autoCompleteResult=[]},_getAddressBoxId:function(){return this._addressBoxIdPrefix+
this._inputStyle.id+ ++this._addressBoxId},_getInput:function(){var a=document.createElement("div");a.className="blass_eai_inputdiv";a.width=this._inputStyle.width;return a},_getRuler:function(){var a=document.createElement("div");a.className="blass_eai_ruler";a.width=this._inputStyle.width;return a},_getAddressBoxLi:function(){var a=document.createElement("li");a.id=this._getAddressBoxId();a.className="blass_eai_li";return a},_getAddressBoxUl:function(){var a=document.createElement("ul");a.className=
"blass_eai_ul";return a},_getVirtualAddressInput:function(){var a=document.createElement("input");a.type="text";a.className="blass_eai_input";return a},_focusVirtualAddressInput:function(){this._virtualAddressInput.select();this._virtualAddressInput.focus()},focus:function(){this._focusVirtualAddressInput()},getAddresses:function(){var a="",b;for(b=1;b<this._addressBoxList.length;b++)this._addressBoxList[b].objValue&&this._addressBoxList[b].isValid&&(a+=this._addressBoxList[b].objValue+",");","===
a.substr(a.length-1,1)&&(a=a.substr(0,a.length-1));return a},createAddressBox:function(a){var b=a.text;if(""!==b){var c=a.validation?a.validation:this.validation(a.value),d=document.createElement("li");d.className="blass_eai_box "+(c?"blass_eai_valid":"blass_eai_invalid");d.id=this._getAddressBoxId();d.objValue=a.value;d.isValid=c;a=document.createElement("span");a.className="blass_eai_address";a.innerHTML=b;d.appendChild(a);b=document.createElement("span");b.className="blass_eai_delete";d.appendChild(b);
b.blass=this;b.onclick=function(){this.blass._removeAddressBox(this.parentNode.id)};this._addressBoxUl.insertBefore(d,this._addressBoxList[0]);this._addressBoxList.push(d)}},_createCSS:function(){if(!this._existCSS&&!document.getElementById("blass_eai")){var a=document.createElement("style");a.id="blass_eai";var b=".blass_eai_ac { border: solid 1px #cccccc; width: 500px; visibility: hidden; position: absolute; background-color:#ffffff; padding: 5px; z-index: 1000; font-size:"+this._inputStyle.fontSize+
"; }",b=b+".blass_eai_aclayer { padding: 0px 0px 3px 0px; cursor:pointer }.blass_eai_select { font-weight: bold; }",b=b+".blass_eai_normal { font-weight: normal; }",c=!1;if("Microsoft Internet Explorer"===navigator.appName){var d=navigator.userAgent;6>=parseInt(d.substring(d.indexOf("MSIE ")+5),null)&&(c=!0,b+=".blass_eai_inputdiv { height: 22px; padding:1px; cursor:text; border:"+this._inputStyle.border+"; }")}c||(b+=".blass_eai_inputdiv { max-height: 52px; overflow-y: auto; padding:1px; cursor:text; border:"+
this._inputStyle.border+"; }");b+=".blass_eai_li { margin-left:6px; }";b+=".blass_eai_ul { list-style-type:none; margin:0px; padding:0px; }";b+=".blass_eai_input { outline:none; width:50px; height: 18px; margin-top: 3px; padding:0px 0px 0px 3px; border:0px solid #ffffff; overflow:hidden; float:left; }";b+=".blass_eai_box { display:block; margin:1px; padding:1px 3px; width:auto; float:left; }";b+=".blass_eai_ruler { position: absolute; overflow:hidden; visibility:hidden; z-index:-1; }";b+=".blass_eai_valid { border:1px solid #bbd8fb; background-color:#f3f7fd; }";
b+=".blass_eai_invalid { border:1px solid #b55e5e; background-color:#fdf5f5; }";b+=".blass_eai_delete { cursor:pointer; margin:5px 0px 0px 5px; float:left; width:9px; height:9px; }";b+=".blass_eai_valid .blass_eai_delete { background:url(data:image/gif;base64,R0lGODlhCQAJAKIAAJu226O83pOx15u32////////wAAAAAAACH5BAEAAAUALAAAAAAJAAkAAAMaGLo6ATAC8Ui0FFo7n44ZsEEZJ3YSOAhsyyYAOw==) no-repeat; }";b+=".blass_eai_invalid .blass_eai_delete { background:url(data:image/gif;base64,R0lGODlhCQAJAKIAALukpaqQkrSanKKGif708v///wAAAAAAACH5BAEAAAUALAAAAAAJAAkAAAMaCLoqEDCG8Ui0FFo7n45ZsEEZJ3YSOKwsmwAAOw==) no-repeat; }";
b+=".blass_eai_address { float:left; }";a.setAttribute("type","text/css");a.styleSheet?a.styleSheet.cssText=b:(b=document.createTextNode(b),a.appendChild(b));(b=document.getElementsByTagName("head")[0])&&b.appendChild(a);this._existCSS=!0}},removeAllAddressBox:function(){if(!(1>=this._addressBoxList.length)){var a;for(a=this._addressBoxList.length-1;0<a;a--)this._removeAddressBox(this._addressBoxList[a].id);this._resetVirtualAddressInput();this._resetAutoCompleteData()}},_resetVirtualAddressInput:function(){this._virtualAddressInput.value=
"";this._inputRuler.innerHTML=""},_removeAddressBox:function(a){if(!(1>=this._addressBoxList.length)){a||(a=this._addressBoxList[this._addressBoxList.length-1].id);document.getElementById(a);var b=[],c;for(c=0;c<this._addressBoxList.length;c++)this._addressBoxList[c].id!==a&&b.push(this._addressBoxList[c]);this._addressBoxList=b;this._addressBoxUl.removeChild(document.getElementById(a))}},_intervalCheckInput:function(){setTimeout(this._intervalCheckInput(),1E3)},_createAddressInput:function(a,b){var c=
a||event;switch(c.keyCode){case 13:case 32:case 186:case 188:var d=null,e=null;this._autoCompleteData&&0<=this._selectedAutoCompleteIndex&&(b.value=this._autoCompleteData[this._selectedAutoCompleteIndex].text,e=this._autoCompleteData[this._selectedAutoCompleteIndex].value,d=!0);b.value=b.value.replace(/^[,;\s]*/,"").replace(/[,;\s]*$/,"");e||(e=b.value);if(""===b.value)return;this._resetAutoCompleteData();this.createAddressBox({text:b.value,value:e,validation:d});this._resetVirtualAddressInput();
break;case 27:this._resetAutoCompleteData();this._resetVirtualAddressInput();break;case 40:case 38:break;default:this._inputRuler.innerHTML=b.value}this._resizeVirtualAddressInput();return 13!==c.keyCode},_createAddressSpecialInput:function(a,b){var c=a||event;switch(c.keyCode){case 8:""===b.value&&(this._resetAutoCompleteData(),this._removeAddressBox());break;case 40:case 38:this._selectAutoCompleteData(40===c.keyCode?1:-1)}this._resizeVirtualAddressInput();return 13!==c.keyCode},_checkInputResetCounter:function(){this._checkInputCounter=
2},_checkInputData:function(){if(this._checkInput){var a=this;setTimeout(function(){a._checkInputBuffer!==a._virtualAddressInput.value?(a._checkInputResetCounter(),a._checkInputBuffer=a._virtualAddressInput.value):a._checkInputBuffer&&a._autoCompleteLast!==a._checkInputBuffer&&(--a._checkInputCounter,0>=a._checkInputCounter&&(a._checkInputResetCounter(),a._setAutoCompleteData(a._virtualAddressInput.value)));a._checkInputData()},this._checkInputInterval)}},_resizeVirtualAddressInput:function(){this._virtualAddressInput.style.width=
this.getInputWidth(this._inputRuler)},getInputWidth:function(a){a=a.offsetWidth+20;50>a&&(a=50);return a+"px"},validation:function(a){return/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(a)}};